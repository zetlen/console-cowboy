[tools]
uv = "latest"
"pipx:cookiecutter" = "latest"

[settings]
python.uv_venv_auto = true

[tasks.cli]
description = "Run the CLI with arguments"
run = "uv run console-cowboy"
raw = true
dir = "{{ config_root }}"

[tasks.sync]
description = "Install dependencies and git hooks"
run = """
uv sync
uv run lefthook install
"""

[tasks.schemas]
depends = ["sync"]
description = "Generate JSON schemas for CTEC format"
run = "uv run python scripts/generate_schemas.py"

[tasks."knowledge-base"]
description = "Fetch terminal documentation for knowledge base (skipped in CI)"
run = """
if [ -n "$CI" ]; then
  echo "Skipping knowledge base fetch in CI environment"
  exit 0
fi
uv sync --group scripts && uv run python scripts/build_knowledge_base.py
"""

[tasks.setup]
depends = ["sync", "schemas", "knowledge-base"]
description = "Full local dev setup (dependencies, hooks, schemas, docs)"
run = "echo 'Development environment ready!'"

[tasks.test]
depends = ["sync"]
description = "Run tests with pytest"
run = "uv run python -m pytest"

[tasks.lint]
description = "Check code formatting and linting"
run = """
uv run ruff format --check .
uv run ruff check .
"""

[tasks."lint:fix"]
description = "Fix code formatting and linting issues"
run = """
uv run ruff format .
uv run ruff check --fix .
"""

[tasks.coverage]
depends = ["sync"]
description = "Run tests with coverage report"
run = "uv run python -m pytest --cov=console_cowboy --cov-report=term-missing"

[tasks.publish]
description = "Build and publish to PyPI"
run = """
rm -rf dist/
uv run python -m build
uv run twine upload dist/*
"""
