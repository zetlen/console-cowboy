# lefthook.yml
# Pre-commit hooks for Console Cowboy
# See: https://lefthook.dev/

commit-msg:
  jobs:
    - name: conventional-commit
      run: uv run cz check --commit-msg-file {1}

pre-commit:
  # Run formatting first (piped group), then other checks in parallel
  piped: true
  jobs:
    - name: ruff-format
      run: uv run ruff format {staged_files}
      stage_fixed: true
      glob: "*.py"

    - name: ruff-lint
      run: uv run ruff check --fix {staged_files}
      stage_fixed: true
      glob: "*.py"

    - name: cli-smoke-test
      run: uv run console-cowboy --help > /dev/null && uv run console-cowboy list > /dev/null
      glob: "*.py"

    - name: uv-lock-check
      run: uv lock --check
      glob:
        - "pyproject.toml"
        - "uv.lock"

    - name: schema-check
      run: |
        uv run python scripts/generate_schemas.py
        if ! git diff --quiet ctec.schema.json iterm2-color-scheme.schema.json; then
          echo "Schema files are out of date! Run 'uv run python scripts/generate_schemas.py' and commit the changes."
          git diff ctec.schema.json iterm2-color-scheme.schema.json
          exit 1
        fi
      glob:
        - "console_cowboy/ctec/schema.py"
        - "console_cowboy/ctec/serializers.py"
